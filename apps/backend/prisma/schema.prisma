generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ContactRequest {
  id                String   @id @default(uuid())
  name              String
  contactMethod     String
  note              String?
  interestType      String
  interestTitle     String
  anonymousSession  String
  createdAt         DateTime @default(now())
}

model Trip {
  id          String          @id @default(uuid())
  title       String
  location    String
  startDate   DateTime
  endDate     DateTime
  joinCode    String          @unique
  organizerId String
  organizer   User            @relation("OrganizerTrips", fields: [organizerId], references: [id])
  guests      TripGuest[]
  timeline    TimelineItem[]
  documents   Document[]
  travelItems TravelItem[]
  createdAt   DateTime        @default(now())
}

model TripGuest {
  id        String   @id @default(uuid())
  tripId    String
  userId    String
  trip      Trip     @relation(fields: [tripId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  joinedAt  DateTime @default(now())

  @@unique([tripId, userId])
}

model TimelineItem {
  id          String   @id @default(uuid())
  tripId      String
  date        DateTime
  title       String
  description String?
  visibility  String
  createdAt   DateTime @default(now())

  Trip Trip @relation(fields: [tripId], references: [id])
}

model Document {
  id              String              @id @default(uuid())
  tripId          String
  uploadedById    String
  uploadedByRole  Role
  visibility      DocumentVisibility
  fileName        String
  createdAt       DateTime            @default(now())

  trip            Trip                @relation(fields: [tripId], references: [id])
}

model ConciergeMessage {
  id        String   @id @default(uuid())
  tripId    String
  userId    String
  sender    String
  body      String
  createdAt DateTime @default(now())
}

model User {
  id             String      @id @default(uuid())
  email          String      @unique
  name           String?
  role           Role
  organizedTrips Trip[]      @relation("OrganizerTrips")
  tripJoins      TripGuest[]
  travelItems    TravelItem[]
  createdAt      DateTime    @default(now())
}

model TravelItem {
  id        String     @id @default(uuid())
  tripId    String
  userId    String
  type      TravelType

  flightDirection FlightDirection?
  airline           String?
  flightNumber      String?
  departureDateTime DateTime?
  arrivalDateTime   DateTime?

  hotelName String?
  roomNumber String?
  checkIn    DateTime?
  checkOut   DateTime?

  airportDepartureDateTime DateTime?
  hotelDepartureDateTime   DateTime?
  transferType             TransferType?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trip Trip @relation(fields: [tripId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@index([tripId])
  @@index([userId])
}

enum FlightDirection {
  ARRIVAL
  DEPARTURE
}

enum TravelType {
  FLIGHT
  STAY
  TRANSFER
}

enum TransferType {
  SHARED
  PRIVATE
  OTHER
}

enum Role {
  GUEST
  ORGANIZER
}

enum DocumentVisibility {
  PRIVATE
  SHARED
}